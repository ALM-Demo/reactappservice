name: deploy
'on':
  push:
    paths:
    - .github/workflows/appservice_workflow.yml
env:
  DOCKER_IMAGE_NAME: "alm-react-appservice-poc1"
  AZURE_WEB_APP: "alm-react-appservice-poc1"
  REGISTRY_NAME: "acralmpoc"

jobs:

  build:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2
    - name: Azure Login
      uses: azure/login@v1
      with:
        creds: ${{ secrets.AZURE_CREDENTIALS }}
    - run: |
       az acr credential show -n $REGISTRY_NAME --query passwords[0].value
       az acr login -name $REGISTRY_NAME --expose-token
    - name: Docker Login
      uses: azure/docker-login@v1
      with:
            login-server: ${{ secrets.REGISTRY_LOGIN_SERVER}}
            username: ${{ secrets.REGISTRY_USERNAME }}
            password: ${{ secrets.REGISTRY_PASSWORD }}
